<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Job Search & Resume Tailoring Assistant</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      width: 400px;
      padding: 15px;
      background-color: #f9f9f9;
    }
    h1 {
      font-size: 18px;
      text-align: center;
    }
    .section {
      margin-bottom: 15px;
    }
    .keyword-bubbles {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    .keyword-bubble {
      padding: 5px 10px;
      border-radius: 15px;
      background-color: #e0e0e0;
      cursor: pointer;
      font-size: 12px;
      user-select: none;
    }
    .keyword-bubble.selected {
      background-color: #0073b1;
      color: white;
    }
    select, input, button, textarea {
      width: 100%;
      padding: 6px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      background-color: #0073b1;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #005582;
    }
    #tailoredResume {
      height: 200px;
      background: white;
      padding: 8px;
      border: 1px solid #ccc;
      overflow-y: auto;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>Job Search & Resume Tailor</h1>

  <!-- Resume Upload -->
  <div class="section">
    <label>Upload Resume (PDF):</label>
    <input type="file" id="resumeUpload" accept=".pdf">
  </div>

  <!-- Keywords -->
  <div class="section">
    <label>Extracted Keywords:</label>
    <div id="keywordsContainer" class="keyword-bubbles"></div>
  </div>

  <!-- Filters -->
  <div class="section">
    <label>Date Posted:</label>
    <select id="dateFilter">
      <option value="">Any time</option>
      <option value="r86400">Past 24 hours</option>
      <option value="r604800">Past week</option>
      <option value="r2592000">Past month</option>
    </select>
  </div>

  <div class="section">
    <label>Location:</label>
    <input type="text" id="locationInput" placeholder="e.g., New York, USA">
  </div>

  <!-- Search Button -->
  <div class="section">
    <button id="searchJobsBtn">Search LinkedIn Jobs</button>
  </div>

  <!-- Tailor Resume -->
  <div class="section">
    <label>Paste Job Description:</label>
    <textarea id="jobDescription" rows="5" placeholder="Paste the job description here"></textarea>
    <button id="tailorResumeBtn">Tailor Resume</button>
  </div>

  <!-- Tailored Resume Output -->
  <div class="section">
    <label>Tailored Resume (Editable):</label>
    <div id="tailoredResume" contenteditable="true"></div>
    <button id="exportDocxBtn">Export as DOCX</button>
    <button id="exportPdfBtn">Export as PDF</button>
  </div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.0.1/docx.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // Set pdf.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    const resumeUpload = document.getElementById('resumeUpload');
    const keywordsContainer = document.getElementById('keywordsContainer');
    const searchJobsBtn = document.getElementById('searchJobsBtn');
    const tailorResumeBtn = document.getElementById('tailorResumeBtn');
    const tailoredResumeDiv = document.getElementById('tailoredResume');

    let extractedKeywords = [];
    let originalResumeText = '';

    resumeUpload.addEventListener('change', async (event) => {
      const file = event.target.files[0];
      if (!file) return;

      const arrayBuffer = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

      let textContent = '';
      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const text = await page.getTextContent();
        text.items.forEach(item => textContent += item.str + ' ');
      }
      originalResumeText = textContent;

      const apiKey = "AIzaSyBoo8nq5Qp1H7C0FLNpu212UQUSOLA99rU"; // Replace with your API key
      const prompt = `Extract exactly 10 short job-relevant keywords from this resume.
Return only keywords, comma-separated, no sentences.

Resume:
${textContent}`;

      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=${apiKey}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }]
          })
        });

        const data = await response.json();
        if (data.candidates?.length) {
          let keywordText = data.candidates[0].content.parts[0].text;
          extractedKeywords = keywordText
            .split(/,|\n/)
            .map(k => k.trim())
            .filter(k => k && k.split(" ").length <= 3);
          renderKeywordBubbles();
        } else {
          alert("No keywords found.");
        }
      } catch (error) {
        console.error("Error extracting keywords:", error);
      }
    });

    function renderKeywordBubbles() {
      keywordsContainer.innerHTML = '';
      extractedKeywords.forEach(keyword => {
        const bubble = document.createElement('div');
        bubble.className = 'keyword-bubble';
        bubble.innerText = keyword;
        bubble.addEventListener('click', () => {
          bubble.classList.toggle('selected');
        });
        keywordsContainer.appendChild(bubble);
      });
    }

    searchJobsBtn.addEventListener('click', () => {
      const selectedKeywords = Array.from(document.querySelectorAll('.keyword-bubble.selected'))
        .map(el => el.innerText)
        .join(' ');

      const dateFilter = document.getElementById('dateFilter').value;
      const location = document.getElementById('locationInput').value.trim();

      let url = `https://www.linkedin.com/jobs/search/?keywords=${encodeURIComponent(selectedKeywords)}`;
      if (location) url += `&location=${encodeURIComponent(location)}`;
      if (dateFilter) url += `&f_TPR=${dateFilter}`;

      window.open(url, '_blank');
    });

    tailorResumeBtn.addEventListener('click', async () => {
      const jobDesc = document.getElementById('jobDescription').value.trim();
      if (!originalResumeText || !jobDesc) {
        alert("Please upload your resume and paste a job description first.");
        return;
      }

      const apiKey = "AIzaSyBoo8nq5Qp1H7C0FLNpu212UQUSOLA99rU"; // Replace with your API key
      const prompt = `Tailor the following resume to better match the given job description.
Preserve structure and bullet points.

Resume:
${originalResumeText}

Job Description:
${jobDesc}`;

      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=${apiKey}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }]
          })
        });

        const data = await response.json();
        if (data.candidates?.length) {
          tailoredResumeDiv.innerText = data.candidates[0].content.parts[0].text;
        } else {
          alert("Could not tailor resume. Try again.");
        }
      } catch (error) {
        console.error("Error tailoring resume:", error);
      }
    });

    document.getElementById('exportDocxBtn').addEventListener('click', () => {
      const doc = new docx.Document({
        sections: [{
          properties: {},
          children: tailoredResumeDiv.innerText.split("\n").map(line =>
            new docx.Paragraph(line)
          ),
        }],
      });
      docx.Packer.toBlob(doc).then(blob => {
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "Tailored_Resume.docx";
        link.click();
      });
    });

    document.getElementById('exportPdfBtn').addEventListener('click', () => {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();
      pdf.text(tailoredResumeDiv.innerText, 10, 10);
      pdf.save("Tailored_Resume.pdf");
    });
  </script>
</body>
</html>
